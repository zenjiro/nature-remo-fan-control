# **紛失した赤外線リモコンを備えた三菱電機製扇風機のスマートホーム統合：Python API解析と音声制御の実装**

本報告書は、赤外線リモコンを紛失した三菱電機製扇風機を、Nature Remo Cloud APIとPythonツールを用いて制御信号を特定・検証し、最終的にAmazon AlexaやGoogle Homeから音声操作可能とするための技術的かつ実践的な手順を提供するものです。このプロジェクトは、単なるリモコンの代替ではなく、IR信号のローレベル解析を通じてカスタム家電をスマートホームのエコシステムに統合するという高度な技術的課題を解決します。

## **I. 扇風機スマート化プロジェクトの技術的概要と前提条件**

### **A. プロジェクト目標と技術フローの定義**

このプロジェクトの最終目標は、リモコンのない扇風機に対し、Nature Remoをハブとして機能させ、スマートスピーカーからのシームレスな音声操作を実現することです。この目標達成のための技術フローは、信号の学習、RAWデータの抽出と解析（Python）、カスタムリモコンの登録、音声対応シーンの作成、およびスマートスピーカー連携という5つの主要なステップで構成されます。

### **B. Nature Remoの対応プロトコルに関する技術的制約**

Nature Remoは、家電の操作において基本的に\*\*赤外線方式（IR）\*\*のリモコンのみに対応しています \[1\]。無線（RF）、Bluetooth、Wi-Fiなどの赤外線以外の通信方式を採用しているリモコンでは、Nature Remoへの登録や操作は一切実行できません \[1\]。三菱電機製の一般的な扇風機は赤外線を使用している可能性が高いものの、本プロジェクトの成功には、対象の扇風機が赤外線方式であることを事前に確認することが絶対的な前提条件となります。

### **C. API選択の戦略：Cloud APIとLocal APIの役割**

Nature Remoの操作には、インターネット経由でアクセスするCloud APIと、ローカルネットワーク内で使用するLocal APIの二種類が存在します \[2, 3\]。

* **Cloud API (推奨):** OAuth2による認証 \[2\] が必要ですが、リモートからのアクセスが可能で、信号の初期登録や管理に適しています。HTTPSリクエストをNature Remoのサーバーに送信することで、センサー情報の取得や赤外線信号の送信といったアクションを実行できます \[3\]。  
* **Local API (高度なテスト用):** ローカルネットワーク上でのみ利用可能であり、遅延が少ないため、Pythonでの信号の試行錯誤や検証を繰り返す際に迅速な応答性を実現できます \[2\]。

### **D. 技術調査の真の目的とRAWデータ解析の必要性**

ユーザーはPythonで「どの信号を送れば良いか調査したい」とされていますが、物理リモコンがないため、通常の「リモコンのボタンを押して信号を学習させる」プロセスで、風量や首振りといった全てのコマンドを取得することは不可能です \[1\]。

したがって、Pythonによる調査の真の目的は、単なる信号の検索ではありません。まず、Nature Remoアプリの手動学習機能などを利用して、扇風機の基本的な単一コマンド（例：電源ON）を一つだけ登録します。次に、**Cloud API経由でこの登録された信号のRAWデータを抽出し、そのデータ構造を解析すること**が、プロジェクトの中心的な技術課題となります。抽出されたRAWデータを基に、扇風機の独自プロトコルを推測し、風量変更や首振りON/OFFに対応する新しいRAWデータをプログラム的に生成・検証するためにPythonを使用します。Pythonは「検索ツール」ではなく、プロトコルを特定し、新しいコマンドを生成する「解析・送信ツール」として機能する必要があります。

## **II. Nature Remo API認証とPython開発環境構築**

Pythonによる信号調査を実施する前に、Nature Remo Cloud APIへのアクセス権を確立し、開発環境を整備します。

### **A. OAuth2認証フローとパーソナルアクセストークンの発行**

Nature Remo Cloud APIを利用するには、OAuth2プロトコルによる認証および認可が必要です \[2\]。開発者はNatureのポータルを通じてパーソナルアクセストークン（PAT）を発行します。このトークンはAPIリクエストの認証ヘッダーに含める必要があり、機密情報として厳重に管理することが求められます。セキュリティの観点から、トークンをPythonコード内に直接記述せず、環境変数や設定ファイルを通じて読み込むことがベストプラクティスです。

### **B. Python環境の準備とリクエストの実装**

PythonからAPIを操作するためには、HTTPリクエストを処理する requests ライブラリと、JSONデータを扱う json ライブラリが必須となります。

Bash

pip install requests

Cloud APIのベースURLは https://api.nature.global/1/ です \[3\]。

### **C. Cloud APIエンドポイント構造の分析と選択**

Swaggerドキュメントで公開されているCloud APIのエンドポイント構造を分析すると、赤外線信号の管理と送信に関する主要なパスが確認できます \[2\]。扇風機の信号を特定、登録、送信するために必要なエンドポイントは以下の通りです。

Nature Remo API シグナル管理エンドポイント（Cloud API）

| 機能カテゴリー | エンドポイント | HTTPメソッド | 目的 |
| :---- | :---- | :---- | :---- |
| アプライアンス取得 | /1/appliances | GET | 登録済み家電（扇風機を含む）のリストとIDの取得 |
| シグナル取得 | /1/appliances/{applianceid}/signals | GET | 特定家電に登録された信号リストの取得（RAWデータ抽出） |
| シグナル送信 | /1/signals/{signalid}/send | POST | 特定の登録済みシグナルを即時送信 |
| カスタムシグナル登録 | /1/appliances/{applianceid}/signals | POST | RAWデータを用いた新しいカスタム信号の登録 |

### **D. ローカルAPI利用の技術的考慮事項**

信号テストの頻度が高い場合、ネットワーク遅延やCloud APIのリクエスト制限（ECHONET Lite関連エンドポイントには追加制限がある \[2\]）を避けるためにLocal APIの利用が検討されます。Local APIのベースURLは remo.local/ です \[2\]。

Local APIを利用する際は、すべてのエンドポイントに対して X-Requested-With ヘッダーを含めることが必須です \[2\]。また、HTTPリクエストにおいて Expect ヘッダーはサポートされていないため、HTTPボディを直接送信する必要があります。例えば、cURLを使用する場合、この動作を実現するために \-H "Expect: " オプションを使用することが求められます \[2\]。ローカルネットワーク上でNature RemoのIPアドレスを特定するには、Bonjourサービス（\_remo.\_tcp）を用いたデバイス発見とアドレス解決が必要です \[2\]。

## **III. Pythonによる赤外線信号の特定・取得・検証（技術調査フェーズ）**

このフェーズでは、Pythonを用いてIR信号のRAWデータを扱い、扇風機の独自プロトコルを解読して全機能を制御する信号を生成します。

### **A. IR信号学習の初期手順とRAWデータ抽出**

1. **初期学習:** 扇風機の電源ON/OFF信号を、Nature Remoアプリのカスタムリモコン作成機能（手動学習）を使って学習させます \[1\]。これは、信号のプロトコル構造と物理的パラメータ（周波数など）を取得するためのベースラインデータとなります。  
2. **RAWデータの抽出:** Nature Remoに登録された扇風機のアプライアンスIDを用いて、Cloud APIの GET /1/appliances/{applianceid}/signals エンドポイントにリクエストを送信します。これにより、学習された信号がJSONペイロードとして返されます。

### **B. IR信号データモデル（IRSignal）の構造分析**

抽出されたJSONペイロードには、IR信号を構成する技術的な要素が含まれています。このデータモデルは IRSignal と呼ばれ、以下の主要なフィールドで構成されます \[2\]。

IRSignal データモデルの構成要素

| フィールド名 | 技術的役割 | データ形式例 | 解説 |
| :---- | :---- | :---- | :---- |
| Freq | キャリア周波数 | 38000 (Hz) | 赤外線変調の物理周波数。一般的な家電は38kHz。 |
| Format | 変調形式 | "raw" | 信号のエンコード方法。カスタムコードは主にRAW形式で扱われる。 |
| Data | パルス列データ | \[9000, 4500, 560,...\] (μs) | 赤外線LEDのON/OFF時間（マイクロ秒単位）の連続リスト。プロトコルの本体。 |

### **C. RAWデータ解析とコマンドの派生（三菱電機プロトコル推測）**

扇風機を完全に制御するためには、風量や首振りなど、単一のIR学習では得られない複数のコマンド信号が必要です。この課題を解決するためには、RAWデータ配列（Dataフィールド）を数学的に解析し、コマンドを派生させる必要があります。

一般的な赤外線プロトコルにおいて、RAWデータ配列は、信号の種類（例：電源ON）や宛先（例：扇風機）を示すヘッダーパルスと、家電の状態（風量、首振り設定など）を定義するデータブロックが続きます。

**解析戦略:**

1. Pythonで抽出した「電源ON」信号のRAWデータを基に、リードイン/リードアウトパルスと、その後に続くデータペイロードを分離します。  
2. 同じメーカー（三菱電機）のIRプロトコルは、データペイロード内の特定のビットまたはバイトが、風量やモードのパラメータに対応している可能性が高いです。例えば、ベース信号のデータブロック内で微細な変更を加えることで、対応する風量（弱、中、強）のコマンド信号を推測し、生成することができます。  
3. Pythonスクリプトは、この推測に基づき、新しい Data 配列を生成し、これを IRSignal JSONペイロードとして構造化します。

### **D. Pythonによるシグナル送信と検証の実装**

生成・修正したIRSignal JSONペイロードの検証は、Cloud APIまたはLocal APIを通じて行われます。

**検証プロセスの設計:**

1. **POSTリクエストの構築:** Pythonで、生成したJSONペイロードをCloud APIのカスタムシグナル登録エンドポイント (POST /1/appliances/{applianceid}/signals) に送信し、新しいシグナルとして登録します。  
2. **即時テスト:** 登録後、POST /1/signals/{signalid}/send エンドポイントを使用して、扇風機に向けて信号を送信し、狙い通りの動作（例：風量が強に変わる）をするかを確認します。  
3. **コマンドの網羅:** このプロセスを繰り返し、「電源ON (全機能)」「電源OFF」「風量 弱/中/強」「首振り ON/OFF」など、必要なすべての機能に対応するRAWデータを生成し、Pythonで動作検証を完了させます。

## **IV. Nature Remoアプリへのカスタムリモコン登録と管理**

Pythonでの信号検証が成功し、必要なすべてのコマンドのRAWデータが確定したら、ユーザーフレンドリーな操作のために、それらの信号をNature Remoアプリのカスタムリモコンとして登録します。

### **A. カスタムリモコンの作成とボタン登録**

Nature Remoアプリ内で新規家電として扇風機を登録する際、既製のリモコンが認識されない場合は「手動学習」を選択します \[1\]。

1. **初期設定:** 扇風機を登録後、「コントロール」画面から右上の「＋」をタップして新しいボタンを登録する画面を開きます \[1\]。  
2. **信号の登録:** 通常は物理リモコンをNature Remo本体に向けて押しますが、本ケースでは、Pythonで検証済みのRAWデータをアプリに登録済みのカスタムシグナルIDと紐付けます。  
3. **ボタンのカスタマイズ:** 登録後、「アイコン」と「表示名」を変更することで、ボタンの視覚的な識別を可能にします \[1\]。例えば、「強風」「首振り開始」といった明確な名称を設定します。

### **B. 必要な機能ボタンの網羅**

カスタムリモコンには、音声操作に必要なすべての単一機能ボタンを網羅して登録することが推奨されます。これには、電源ON/OFF、各風量設定、首振りON/OFFなどが含まれます。

## **V. スマートホーム連携の核：シーンの設計と応用展開**

スマートスピーカーは、カスタム登録されたIRコード（扇風機の風量や首振りなど）を直接「デバイス」として認識し操作することは通常できません。そのため、Nature Remoの**シーン機能**が、カスタムIRコードをスマートスピーカーに公開するための必須のブリッジとして機能します。

### **A. シーン機能の役割**

シーンは、複数の家電操作やカスタムIRコマンドを一つにまとめた「単一の実行可能なアクション」として機能します \[4\]。スマートスピーカー側からは、このシーンが実行可能な「定型アクション」または「ルーティン」として認識されるため、複雑なカスタム操作を音声でトリガーできるようになります \[4\]。

### **B. 効果的なシーンの作成例**

ユーザーが自然な音声コマンドを使用できるように、検証済みのカスタムボタン操作を組み合わせてシーンを設計します。

1. **シーン名: 「扇風機\_リラックス」**  
   * 目的: 寝る前やリラックス時。  
   * アクション: 扇風機（カスタムリモコン）の「電源ON」と「風量 弱」を順番に実行。  
2. **シーン名: 「扇風機\_停止」**  
   * 目的: 運転終了。  
   * アクション: 扇風機（カスタムリモコン）の「電源OFF」を実行。

## **VI. スマートスピーカー連携の実現と実践的な音声コマンド設定**

作成したシーンをAlexaおよびGoogle Homeに連携し、音声コマンドから実行できるように設定を完了します。

### **A. Amazon Alexaとの連携と設定**

1. **Nature Homeスキルの有効化:** Amazon Alexaアプリ内で「Nature Home」スキルを有効化し、Nature Remoアカウントと連携を完了させます \[5, 6\]。  
2. **定型アクションの設定:**  
   * Alexaアプリの「定型アクション」メニューで新しいアクションを作成します \[4\]。  
   * **実行条件（トリガー）:** ユーザーが発話する自然なコマンド（例：「アレクサ、涼しくして」「アレクサ、静かにして」）を設定します \[4\]。  
   * **アクション:** アクション設定で「スマートホーム」→「シーン」を選択し、Nature Remoアプリで作成した対応するシーン（例：「扇風機\_リラックス」）を紐付けます \[4\]。  
   * **注意点:** カスタムモード操作時、Alexaが「現在カスタムモードです」と返答する場合がありますが、これは正常な動作です \[5\]。

### **B. Google Homeとの連携と設定**

1. **Nature Remoの連携確認:** Google Homeアプリ内でNature Remoが連携済みであることを確認します \[7\]。  
2. **Google Homeルーティン（Automation）の設定:**  
   * Google Homeアプリを開き、最下部中央の「オートメーション」をタップし、「＋」ボタンで新規ルーティンを作成します \[4\]。  
   * **ルーティンの種類を選択:** 「個人用」または「家のメンバー」を選択します \[4\]。  
   * **開始条件（アシスタントにこう言ったとき…）:** 音声コマンド（例：「OK Google, 扇風機をつけて」「OK Google, 扇風機を止めて」）を設定します \[4\]。  
   * **アクションの設定:** 「アクションを追加」→「スマートホーム」→「シーン」を選択し、Nature Remoで作成した対応するシーンを紐付けます \[4\]。

スマートスピーカー連携：音声コマンドとシーンの対応表

| 操作対象機能 | Nature Remo シーン名 | Alexa推奨トリガー | Google Home推奨トリガー |
| :---- | :---- | :---- | :---- |
| 電源ON/風量 中 | 扇風機\_自動運転 | 「アレクサ、風を頼む」 | 「OK Google, 扇風機をつけて」 |
| 風量 弱 | 扇風機\_おやすみモード | 「アレクサ、静かにして」 | 「OK Google, 扇風機を弱く」 |
| 首振り ON | 扇風機\_首振り開始 | 「アレクサ、首振りして」 | 「OK Google, 扇風機を振って」 |
| 電源 OFF | 扇風機\_停止 | 「アレクサ、扇風機を消して」 | 「OK Google, 扇風機を止めて」 |

## **VII. 結論と高度な利用法**

### **A. プロジェクトの成果と結論**

本プロジェクトは、紛失したリモコンという物理的な制約に対し、Nature Remo Cloud APIとPythonを用いた技術的な解析によって克服策を見出しました。具体的には、初期学習信号のRAWデータ（Freq, Format, Data）を抽出し \[2\]、そのパルス列を解析することで、扇風機の全機能に対応するカスタム信号を生成・検証するという高度なプロセスを経て、全機能の音声操作を実現可能としました。この手法は、汎用リモコンデータベースに存在しない独自プロトコルを持つ家電をスマートホームに組み込むための有効なソリューションとなります。

### **B. センサーデータに基づいた自動制御への応用**

Nature Remoは、温度、湿度、照度などの環境センサーを搭載しており \[8\]、単なるリモコンとしての機能を超えた自動制御の可能性を秘めています。

Pythonによる信号検証を経てアプリに登録されたカスタムシーンを、このセンサー情報と組み合わせることで、高度なオートメーションが実現できます。例えば、Nature Remoが取得した室温データに基づき、室温が28℃を超えた場合に、自動的にシーン「扇風機\_リラックス」（電源ON、弱風）を実行するように設定できます。これにより、リモコン紛失の不便さを解消するだけでなく、ユーザーが意識せずとも熱中症の予防 \[4\] に貢献する、快適でインテリジェントな居住空間が構築されます。このような自動化は、Nature Remoアプリや外部連携サービス（IFTTTなど）を通じて実現可能です。